{% extends 'base.html' %}

{% block content %}
<div class="container mt-5 pt-5 pb-5">
    <div class="row align-items-center mb-5">
        <div class="col-lg-7">
            <span class="badge bg-primary mb-2 rounded-pill px-3">Интерактивное демо</span>
            <h1 class="fw-bold display-5">Конфигуратор стоимости</h1>
            <p class="lead text-muted">
                Это пример логики, которую мы можем внедрить в ваш бизнес. 
                Динамический расчет, изменение состояний и мгновенный отклик интерфейса.
            </p>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-7">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                    <h4 class="fw-bold"><i class="bi bi-sliders me-2 text-primary"></i> Параметры проекта</h4>
                </div>
                <div class="card-body p-4">
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold mb-3">1. Выберите платформу</label>
                        <div class="row g-3">
                            <div class="col-4">
                                <input type="radio" class="btn-check" name="platform" id="web" value="1" checked onchange="calc()">
                                <label class="btn btn-outline-light text-dark w-100 h-100 p-3 border text-start" for="web">
                                    <i class="bi bi-laptop fs-3 text-primary mb-2 d-block"></i>
                                    <span class="fw-bold">Web Сайт</span>
                                    <div class="small text-muted mt-1">Landing / Corp</div>
                                </label>
                            </div>
                            <div class="col-4">
                                <input type="radio" class="btn-check" name="platform" id="bot" value="0.7" onchange="calc()">
                                <label class="btn btn-outline-light text-dark w-100 h-100 p-3 border text-start" for="bot">
                                    <i class="bi bi-robot fs-3 text-primary mb-2 d-block"></i>
                                    <span class="fw-bold">TG Бот</span>
                                    <div class="small text-muted mt-1">Автоматизация</div>
                                </label>
                            </div>
                            <div class="col-4">
                                <input type="radio" class="btn-check" name="platform" id="app" value="1.8" onchange="calc()">
                                <label class="btn btn-outline-light text-dark w-100 h-100 p-3 border text-start" for="app">
                                    <i class="bi bi-phone fs-3 text-primary mb-2 d-block"></i>
                                    <span class="fw-bold">Mobile App</span>
                                    <div class="small text-muted mt-1">iOS / Android</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4 text-muted opacity-25">

                    <div class="mb-4">
                        <label class="form-label fw-bold d-flex justify-content-between">
                            <span>2. Уровень дизайна</span>
                            <span class="badge bg-light text-primary" id="designVal">Стандарт</span>
                        </label>
                        <input type="range" class="form-range" min="1" max="3" step="1" id="designRange" oninput="calc()">
                        <div class="d-flex justify-content-between text-muted small mt-2">
                            <span>MVP (Шаблон)</span>
                            <span>Custom (Figma)</span>
                            <span>Premium (3D/Motion)</span>
                        </div>
                    </div>

                    <hr class="my-4 text-muted opacity-25">

                    <div class="mb-2">
                        <label class="form-label fw-bold mb-3">3. Функционал</label>
                        
                        <div class="form-check form-switch mb-3 p-3 bg-light rounded d-flex align-items-center justify-content-between ps-5">
                            <div>
                                <label class="form-check-label fw-bold" for="adminPanel">Админ-панель</label>
                                <div class="small text-muted">Управление контентом без кода</div>
                            </div>
                            <input class="form-check-input fs-4" type="checkbox" id="adminPanel" onchange="calc()">
                        </div>

                        <div class="form-check form-switch mb-3 p-3 bg-light rounded d-flex align-items-center justify-content-between ps-5">
                            <div>
                                <label class="form-check-label fw-bold" for="payment">Прием платежей</label>
                                <div class="small text-muted">Интеграция Stripe / CloudPayments</div>
                            </div>
                            <input class="form-check-input fs-4" type="checkbox" id="payment" onchange="calc()">
                        </div>

                        <div class="form-check form-switch p-3 bg-light rounded d-flex align-items-center justify-content-between ps-5">
                            <div>
                                <label class="form-check-label fw-bold" for="aiFeature">
                                    <i class="bi bi-stars text-warning me-1"></i> AI / ChatGPT
                                </label>
                                <div class="small text-muted">Умный ассистент внутри продукта</div>
                            </div>
                            <input class="form-check-input fs-4" type="checkbox" id="aiFeature" onchange="calc()">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="card shadow border-0 text-white grad-btn h-100 sticky-top" style="top: 100px; z-index: 1;">
                <div class="card-body p-5 d-flex flex-column justify-content-center text-center">
                    <h3 class="opacity-75 mb-4">Предварительная смета</h3>
                    
                    <div class="bg-white bg-opacity-10 p-4 rounded-3 mb-4 backdrop-blur">
                        <small class="text-uppercase tracking-wide opacity-75">Бюджет</small>
                        <h1 class="display-3 fw-bold my-2" id="totalPrice">--</h1>
                    </div>

                    <div class="row g-3">
                        <div class="col-6">
                            <div class="p-3 bg-white bg-opacity-10 rounded-3 h-100">
                                <i class="bi bi-calendar-event fs-4 mb-2 d-block"></i>
                                <small class="opacity-75">Срок (дни)</small>
                                <div class="h3 fw-bold m-0" id="totalDays">--</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 bg-white bg-opacity-10 rounded-3 h-100">
                                <i class="bi bi-tools fs-4 mb-2 d-block"></i>
                                <small class="opacity-75">Поддержка</small>
                                <div class="h3 fw-bold m-0">3 мес.</div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-5">
                        <a href="{{ url_for('index', _anchor='contact') }}" class="btn btn-light text-primary fw-bold w-100 py-3 rounded-pill shadow-lg">
                            Заказать эту конфигурацию
                        </a>
                        <p class="small opacity-50 mt-3">*Расчет приблизительный и не является офертой</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function calc() {
        // Базовые ставки
        let basePrice = 80000; // Тенге или Рубли
        let baseDays = 7;

        // Получаем значения
        let platformEl = document.querySelector('input[name="platform"]:checked');
        let platformMult = parseFloat(platformEl.value);
        let designLevel = parseInt(document.getElementById('designRange').value);
        
        // Чекбоксы
        let hasAdmin = document.getElementById('adminPanel').checked;
        let hasPayment = document.getElementById('payment').checked;
        let hasAI = document.getElementById('aiFeature').checked;

        // Дизайн логика
        let designMult = 1;
        let designText = "Стандарт";
        if(designLevel === 1) { designMult = 0.8; designText = "Базовый (MVP)"; }
        if(designLevel === 2) { designMult = 1.0; designText = "Индивидуальный"; }
        if(designLevel === 3) { designMult = 1.6; designText = "Premium / Motion"; }
        document.getElementById('designVal').innerText = designText;

        // Расчет
        let total = basePrice * platformMult * designMult;
        let days = baseDays * platformMult * designMult;

        // Допы
        if(hasAdmin) { total += 30000; days += 3; }
        if(hasPayment) { total += 40000; days += 4; }
        if(hasAI) { total += 60000; days += 7; }

        // Округляем до тысяч
        total = Math.ceil(total / 1000) * 1000;
        days = Math.ceil(days);

        // Анимация чисел (простая подмена, для эффекта можно использовать JS библиотеки типа CountUp.js)
        document.getElementById('totalPrice').innerText = total.toLocaleString() + " ₸";
        document.getElementById('totalDays').innerText = days;
    }
    
    // Инициализация
    window.addEventListener('DOMContentLoaded', calc);
</script>
{% endblock %}